# 렉시컬 환경(Lexical Environment)

자바스크립트에서 코드가 실행될 때 변수나 함수 같은 식별자의 유효 범위를 관리하는 내부 메커니즘

-> 현재 코드에서 "무엇을 어디서 찾을지"를 담고 있는 일종의 설계도

## 구성 요소

### 환경 레코드(Environment Record)

현재 컨텍스트(예: 함수, 전역, 블록)에서 선언된 변수, 함수, 파라미터, this 값을 저장하는 공간

- ex: var, let, const로 선언된 변수들, 함수 선언식 등

### 외부 렉시컬 환경 참조(Outer Lexical Environment Reference)

- 현재 환경이 끝나면 어디로 올라가서 찾아볼지 가리키는 연결고리

-  ex: 함수 -> 바깥 함수

## 예시

```
let x = 1;

function outer() {
  let y = 2;

  function inner() {
    let z = 3;
    console.log(x, y, z);
  }

  inner();
}

outer();
```

**global**
 - 환경 레코드: 	x -> 1, outer -> function
 - outer 참조: null

**outer**
  - 환경 레코드: y -> 2, innter -> function
  - outer 참조: global

**inner**
  - 환경 레코드: z -> 3
  - outer 참조: outer

## 클로저와의 관계

클로저 => 함수 + 그 함수가 선언될 때의 렉시컬 환경(스코프 체인) 정보

**함수 선언 시 -> 렉시컬 환경 생성**
- 함수가 선언되면, 자바스크립트는 이 함수가 어디에서 선언됐는지(상위 스코프)를 기억
- 이게 바로 렉시컬 환경의 outer 참조

**함수 실행 시 -> 새로운 렉시컬 환경 생성**
- 함수가 실행되면 실행 컨텍스트가 만들어지고, 그 안에 렉시컬 환경이 생성됨

**내부 함수에서 외부 변수 접근 -> 클로저 형성**
- 내부 함수에서 외부 함수의 변수를 참조하면, 내부 함수는 외부 함수의 렉시컬 환경을 outer 참조로 연결해서 기억
- 이렇게 연결된 함수 + 환경 정보 묶음을 클로저라고 부름

## 스코프 체인과의 관계

스코프 체인 -> 현재 렉시컬 환경에서 변수나 함수를 찾지 못하면, outer 참조를 따라 바깥 렉시컬 환경으로 계속 올라가는 연결 구조

=> 렉시컬 환경들이 연결된 사슬(chain)

## 실행 컨텍스트와의 관계

실행 컨텍스트 -> 코드가 실행될 때 필요한 정보(변수, this, 스코프 등)를 담고 있는 실행 환경

=> 자바스크립트 엔진은 코드를 실행할 때 무조건 실행 컨텍스트를 만들고, 그 안에 렉시컬 환경을 생성
